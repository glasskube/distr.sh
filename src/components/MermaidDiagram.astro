---
// MermaidDiagram.astro
const { chart } = Astro.props;
const id = `mermaid-${Math.random().toString(36).substring(2, 10)}`;
---

<div class="mermaid-wrapper">
  <div id={id} class="mermaid">
    {chart}
  </div>
</div>

<style>
  .mermaid-wrapper {
    display: flex;
    justify-content: center;
    margin: 2rem auto;
    padding: 2rem;
    background-color: #111;
    border-radius: 12px;
    overflow-x: auto;
    max-width: 100%;
    min-width: 0;
  }

  :global(.mermaid) {
    font-family: monospace !important;
    background-color: #111;
    max-width: 100%;
    width: 100%;
    text-align: center;
  }

  :global(.mermaid svg) {
    width: 100% !important;
    max-width: 1000px !important;
    height: auto !important;
    min-width: 600px;
    margin: 0 auto;
  }

  :global(.mermaid .node rect,
          .mermaid .node polygon,
          .mermaid .node ellipse) {
    fill: #111 !important;
    stroke: #fff !important;
    stroke-width: 2px !important;
    rx: 6;
    ry: 6;
  }

  :global(.mermaid .node .label) {
    color: #fff !important;
    font-size: 16px !important;
    padding: 8px;
  }

  :global(.mermaid .edgePath .path) {
    stroke: #fff !important;
    stroke-width: 2px !important;
  }

  :global(.mermaid .arrowheadPath) {
    fill: #fff !important;
    stroke: #fff !important;
  }

  :global(.mermaid .cluster rect) {
    fill: none !important;
    stroke: #888 !important;
    stroke-dasharray: 4;
    rx: 8;
    ry: 8;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const mermaid = await import('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs');
      mermaid.default.initialize({
        startOnLoad: true,
        theme: 'dark',
        logLevel: 'fatal',
        securityLevel: 'loose',
        darkMode: true,
        fontFamily: 'monospace',
        flowchart: {
          htmlLabels: false,
          curve: 'basis',
          nodeSpacing: 60,
          rankSpacing: 60,
        }
      });
      mermaid.default.run();
    } catch (error) {
      console.error('Failed to initialize Mermaid:', error);
    }
  });
</script>
